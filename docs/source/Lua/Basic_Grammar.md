# 1 Lua基础语法

直接调用Lua语言独立解释器(stand-alone interpreter)执行lua文件：
```shell
$ lua hello.lua
```

**Chunk**  
我们将Lua语言执行的每一段代码(e.g. 一个文件，交互模式下的一行)称为一个Chunk(程序段)，  
即一组命令或表达式组成的序列。程序段在大小上并没有限制。

除了将源码保存为文件，也可以直接在交互模式(interactive mode)下运行独立解释器:
```shell
$ lua
Lua 5.4.4  Copyright (C) 1994-2022 Lua.org, PUC-Rio
>
```
可以通过EOF或`exit()`函数退出交互模式。

在Lua5.3之前，如果想在交互模式下获得输出的值，需要在语句前边加上等号`=`，  
如果不想输出结果，可以在行末加上一个分号`;`

使用`-i`参数，让Lua解释器在执行完指定文件后进入交互模式：
```shell
$ lua -i hello.lua
```
这对于调试和手工测试很有用。

另一种运行运行文件的方式是在交互模式下输入`dofile()`，该函数会立即执行一个文件。

使用`-e`参数，可以在命令行直接输入代码：
```shell
$ lua -e "print(math.sin(12))"
-0.53657291800043
```

`-l`参数用于加载库。
```shell
$ lua -i -llib -e "x = 10"
# 首先加载lib库，然后执行'x = 10'的赋值语句，最终进入交互模式
```

解释器在处理参数前，会先查找名为`LUA_INIT_5_3`的环境变量(依据安装的Lua版本，数字会变化)。  
如果找不到，会再查名为`LUA_INIT`的环境变量。  
如果任意一个存在，并且其内容为`@myfile`，那么解释器就会运行相应的文件;如果存在但不是以`@`开头，  
那么解释器会将其当作Lua代码，对其解释执行。

可以通过预先定义的全局变量`arg`来获取解释器传入的参数。编译器在运行代码前会创建一个名为`arg`  
的表，其中存储了所有的命令行参数。索引`0`中保存的内容为脚本名，其他类推，如以下代码，
```shell
$ lua -e "sin=math.sin" myluafile a
```
编译器会按如下方式获取参数：
`arg[-3] = "lua", arg[-2] = "-e", arg[-1] = "sin=math.sin", arg[0] = "myluafile", arg[1] = "a"`

下划线+大写字母组成的标识符通常被Lua用作特殊用途，应避免将其用作其他用途。

Lua使用 `--`做单行注释。`--[[xxx]]`做多行注释

Lua不区分未初始化变量和被赋值为nil的变量。

Lua中有八种基本类型：`nil`（空），`boolean`（布尔），`number`（数值），`string`（字符串），  
`userdata`（用户数据），`function`（函数），`thread`（线程），`table`（表）。  
使用函数`type()`可以获取一个值对应的类型名称(返回字符串)。

在Lua中，条件测试和逻辑运算将除falsee和nil外的所有其他值视为真。(0和""也被视为真)。

逻辑运算`and`, `or`, `not`。  
`and`和`or`不返回布尔(注意！⚠️)。而是根据短路求值的结果，返回第一或第二个操作数。  
`not`永远返回布尔类型。

## 数值

Lua5.2及之前的版本中，所有数值都以双精度浮点格式表示。  
从Lua5.3开始，Lua为数值格式提供了两种选择：被称为`integer`的64位整型和被称为`float`的双精度浮点类型。  
对于资源受限的平台，我们可以将Lua5.3编译为*精简Lua(Small Lua)*模式，该模式使用32位整形和单精度浮点类型。  
除了使用了`LUA_32BITS`宏外，精简Lua和标准Lua的源码是一样的。  
除了数值表示占用的字节大小不一样外，精简Lua和标准Lua完全一致。

### 字面量

```lua
Lua 5.4.4  Copyright (C) 1994-2022 Lua.org, PUC-Rio
> 1
1
> 0.1
0.1
> 1.23e-3
0.00123
> 0.3e12
300000000000.0
> 5E+20
5e+20
> 0xff
255
-- 整数和浮点数是相等的：
> 1 == 1.0
true
-- 需要区分整形和浮点型时，使用math.type:
> math.type(3)
integer
> math.type(3.0)
float
-- 十六进制浮点数：p/P作为指数标志。Lua5.2开始支持。
> 0x0.2
0.125
> 0x1p-1
0.5
> 0xa.bp2
42.75
-- 通过%a格式化：
> string.format("%a", 419)
0x1.a3p+8
>
```

### 算术操作

由于各版本Lua都不同，因此推荐直接使用解释器试下。  

Lua5.3新运算符：`//` 整除。

实数取模技巧：
```lua
> x = math.pi
> x - x%0.01 -- 保留两位小数
3.14
> x - x%0.001 -- 保留三位小数
3.141
> 
```

幂运算符 `^`: `x^0.5`取平方根

关系运算符(`< > >= <= == ~=`)。结果都是Boolean类型。

数学库`math`提供了三个取整函数：
* floor : 向负无穷取整
* ceil : 向正无穷取整
* modf : 向0取整。同时返回小数部分作为第二个结果

可使用`math.maxinteger`, `math.mininteger`获取整型的最大/最小值
```lua
> math.maxinteger
9223372036854775807
> math.mininteger
-9223372036854775808
> 
```

### 随机数

函数`math.random`用于生成伪随机数，共有三种调用方式：  
* 不带参数调用：返回一个在`[0, 1)`范围内的实数。
* 带有一个整形值`n`： 返回一个在`[1, n]`范围内的整数。
* 带两个整数`l`和`u`调用：返回`[l, u]`范围内的整数。

函数`math.randomseed`用于设置伪随机数发生器的种子。参数为一个数值。  
程序启动时，系统固定使用`1`为种子来初始化发生器。

## 字符串



